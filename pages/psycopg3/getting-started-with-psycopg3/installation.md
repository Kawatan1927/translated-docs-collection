### インストール

手短に言えば、サポートされているシステムを使用している場合は以下の通りです:

```bash
pip install --upgrade pip           # pip を少なくとも 20.3 以上にアップグレード
pip install "psycopg[binary]"         # PyPy を使用している場合は [binary] を外す
```

これで準備は完了です。その他のインストール方法については、以下をお読みください。

#### 注意

豆知識: psycopg3 パッケージは存在せず、psycopg だけです！

---

### サポートされているシステム

ここでドキュメント化されている Psycopg のバージョンは、以下の環境で公式かつテスト済みのサポートがされています:

- **Python:** バージョン 3.9 から 3.13  
  ※ Psycopg 3.3 より前では Python 3.8 がサポート  
  ※ Psycopg 3.2 より前では Python 3.7 がサポート  
  ※ Psycopg 3.1 より前では Python 3.6 がサポート

- **PyPy:** バージョン 3.9 から 3.10  
  ※注意: ピュア Python バージョンのみサポートされます。

- **PostgreSQL:** バージョン 10 から 17  
  ※ 注意: 現在サポートされている PostgreSQL のリリースは CI で積極的にテストされています。サポート対象外のリリースはベストエフォートでのサポートとなります。

- **OS:** Linux、macOS、Windows

テストは Github のワークフロー内で実行されています。そこでテストされていない環境は公式にはサポートされません。これには以下が含まれます:

- Conda などの非公式な Python ディストリビューション
- PostgreSQL の代替実装
- BSD や Solaris などのその他のプラットフォーム

サポートされていないシステムを使用する場合、動作する可能性はあります（例: データベースが PostgreSQL と同じワイヤプロトコルを使用している場合など）が、正しく動作する保証やスムーズな利用はできません。

---

### バイナリインストール

Psycopg 3 で開発を開始する最速の方法は、バイナリパッケージをインストールすることです。以下のコマンドを実行してください:

```bash
pip install "psycopg[binary]"
```

これにより、必要なライブラリがすべて含まれた自己完結型のパッケージがインストールされます。pip は少なくとも 20.3 以上が必要ですので、事前に `pip install --upgrade pip` を実行して更新してください。

#### 参考情報

Psycopg 3 のインストールが正常に完了した場合は、基本的なモジュールの使い方に進み、動作確認をしてください。

上記の方法でうまくいかない場合は、他のインストール方法を引き続きご覧ください。

パッケージ間の違いについての詳細は、pq モジュールの実装をご参照ください。

もし、あなたのプラットフォームがサポートされていない場合や、同梱されている libpq が適さない場合は、ローカルインストールまたはピュア Python インストールに進むべきです。

#### 注意

バイナリパッケージはベストエフォート方式で作成されます。サポートされるプラットフォームは、パッケージビルドに利用可能な CI ランナーに依存します。つまり：

- Python の新しいバージョン用のバイナリパッケージは、ビルドに使われるランナーがそのバージョンをサポートしてから利用可能になります。お使いのプラットフォームがサポートされているかは、psyocpg-binary の PyPI ファイルで確認できます。
- バイナリパッケージに含まれる libpq のバージョンは、ランナー上で利用可能なバージョンに依存します。利用可能な機能については、`psycopg.pq.version()` 関数や `__build_version__` 定数で確認できます。

#### 警告

Psycopg 3.1.20 以降、ARM64 macOS バイナリパッケージ（Apple M1 マシン向け）は、macOS バージョン 14.0 未満では提供されなくなりました。OS を少なくとも 14.0 以上にアップグレードするか、ローカルインストールまたは Python インストールを使用してください。

なお、バイナリインストールは PyPy ではサポートされません。

---

### ローカルインストール

「ローカルインストール」は、パフォーマンスと保守性に優れたライブラリを提供します。この方法では、C で書かれた高速化モジュールが含まれ、システムライブラリ（libpq、libssl など）にリンクされるため、システムのライブラリアップグレードが Psycopg 3 で使用されるライブラリにも反映されます。これは、プロダクションサイト向けに Psycopg をインストールする推奨方法です。

ローカルインストールを行うためには、以下の前提条件が必要です:

- C コンパイラ
- Python の開発用ヘッダ（例: python3-dev パッケージ）
- PostgreSQL クライアントの開発用ヘッダ（例: libpq-dev パッケージ）
- PATH 上にある pg_config プログラム

また、拡張モジュールのビルドに関するトラブルシューティング（コンパイラのエラーメッセージの読解など）ができることが前提となります。もし対応が難しい場合は、この方法は避け、バイナリインストールを利用してください。

必要な前提条件が整っている場合、以下のコマンドを実行します:

```bash
pip install "psycopg[c]"
```

#### 警告

ローカルインストールは PyPy ではサポートされません。

---

### ピュア Python インストール

もし以下のようにインストールした場合:

```bash
pip install psycopg
```

`[c]` や `[binary]` のオプションがないため、ピュア Python 実装が得られます。これはデバッグやハックに便利ですが、システム上に libpq が存在する必要があります（ctypes を介して動的にインポートされます）。

ピュア Python インストールを使用するには、システムに libpq がインストールされている必要があります。例えば、Debian 系のシステムでは以下のようにする必要があるでしょう:

```bash
sudo apt install libpq5
```

#### 注意

libpq は、PostgreSQL のコマンドラインクライアントである psql がデータベースに接続するために使用するクライアントライブラリです。ほとんどのシステムでは、psql をインストールすると libpq も依存関係としてインストールされます。

もしこの要件を満たすことができない場合は、バイナリインストールを利用してください。

---

### コネクションプールのインストール

Psycopg のコネクションプールは、psycopg パッケージとは別のパッケージとして配布され、別のリリースサイクルが設定されています。

コネクションプールを使用するには、以下のように pool オプションを付けてインストールしてください:

```bash
pip install "psycopg[pool]"
```

または、より正確なリリース指定ができるように、psycopg_pool パッケージを個別にインストールすることも可能です。

---

### 依存関係の取り扱い

プロジェクトの依存関係（例: requirements.txt、setup.py、pyproject.toml の依存関係など）を指定する必要がある場合、以下のいずれかを指定するのが良いでしょう:

- **ライブラリの場合:** psycopg への依存関係を追加してください。これにより、ライブラリの利用者が適切なインターフェイスを持つ psycopg パッケージを使用できるようになり、特定の実装を選択する自由が残されます。

- **最終的なアプリケーションの場合:** 依存ライブラリやツールがホストマシンにインストールされていることを確認した上で、例えば psycopg[c] のように特定の実装を要求することができます。

どちらの場合も、要件指定子を用いて使用する Psycopg のバージョンを指定することが可能です。

もし特定の実装を必ず使用させたい場合は、PSYCOPG_IMPL 環境変数を指定することができます。指定された実装が利用できない場合、ライブラリのインポートが失敗します。詳しくは pq モジュールの実装をご参照ください。
